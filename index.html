<!doctype html>
<html lang='en-GB'><meta charset='utf-8'>
<head>

<script>
var
	DEG2RAD=57.2958;
var
	DBG='debug'.
	MAXX,MAXY,
	ctx,cty,mag,
	marqx1,marqy1,marqx2,marqy2,marqon,
	objects;

function Object(posx,posy){
	this.element=document.createElement('img');
	this.element.src='zenith.png';this.size=1024;
	this.posx=posx;
	this.posy=posy;
	this.ang=30;
	this.dposx=this.posx;
	this.dposy=this.posy;
	this.dang=this.ang;
	this.selected=false;
	this.paint=function(){
		xpos=(MAXX/2-((this.size>>1)+ctx-this.posx)*mag);
		ypos=(MAXY/2-((this.size>>1)+cty-this.posy)*mag);
		if (this.selected){
			this.element.style='border:2px solid blue; transform:rotate('+this.ang+'deg); position:fixed;width:'+(this.size*mag)+'px;left:'+xpos+'px;top:'+ypos+'px;';
		}
		else{
			this.element.style='border:none; transform:rotate('+this.ang+'deg); position:fixed;width:'+(this.size*mag)+'px;left:'+xpos+'px;top:'+ypos+'px;';
		}
	}
	this.setHeading=function(dposx,dposy){
		this.dposx=dposx; this.dposy=dposy;
		this.dang=DEG2RAD*Math.atan((this.dposy-this.posy)/(this.dposx-this.posx));
		if (this.dposx<this.posx) this.dang+=180;
		while (this.dang>=360) this.dang-=360;
		while (this.dang<0) this.dang+=360;
		while (this.ang>=360) this.ang-=360;
		while (this.ang<0) this.ang+=360;
	}
	this.move=function(){
		if ((this.destx!=this.posx)||(this.desty!=this.posy)){
			if (this.ang!=this.dang){
				d=this.dang-this.ang;
				if (d>180) d-=360;
				if (d<-180) d+=360;
				if (Math.abs(d)<0.5){ this.ang=this.dang; d=0;}
				if (d>0)	this.ang+=1;
				else if (d<0) this.ang-=1;
			}
			else{
				if (Math.abs((this.posx-this.dposx)+(this.posy-this.dposy))>1){
					this.posx+=1*Math.cos(this.ang/DEG2RAD)
					this.posy+=1*Math.sin(this.ang/DEG2RAD)
				}
				else{
					this.posx=this.dposx;
					this.posy=this.dposy;
				}
			}
		}
	}
};

function repaint(){
	document.body.innerHTML='';
	for (i=0;i<objects.length;i++){
		objects[i].paint();
		document.body.appendChild(objects[i].element);
	}
	document.body.innerHTML+='<div id=\'dbg\' style=\'position:fixed;top:0px;left:0px;color:#f80;background:#800;\'>'+DBG+'</div>';
	if (marqon){
		if (marqx1>marqx2){marq_x1=marqx2;marq_x2=marqx1} else {marq_x1=marqx1;marq_x2=marqx2;}
		if (marqy1>marqy2){marq_y1=marqy2;marq_y2=marqy1} else {marq_y1=marqy1;marq_y2=marqy2;}
		document.body.innerHTML+='<div style=\'position:fixed;top:'+marq_y1+'px;left:'+marq_x1+'px;height:'+(marq_y2-marq_y1)+'px;width:'+(marq_x2-marq_x1)+'px;border:1px solid blue;background:none;\'></div>';
	}
}
function run(){
	for (i=0;i<objects.length;i++){
		objects[i].move();
	}
	repaint();
	setTimeout(run,25);
}
function init(){
	mag=0.25; ctx=0; cty=0;
	marqon=false;
	MAXX=window.innerWidth;
	MAXY=window.innerHeight;
	document.body.style='width:100%; height:100%; color:white; background:black; margin:0px 0px; padding:0px 0px;';
	objects=[];
	document.addEventListener('wheel',function(e){
		ctx+=((e.clientX-(MAXX>>1))/mag);
		cty+=((e.clientY-(MAXY>>1))/mag);
		e.deltaY>0?mag/=2:mag*=2;
		ctx+=((-e.clientX+(MAXX>>1))/mag);
		cty+=((-e.clientY+(MAXY>>1))/mag);
		repaint();
	});
	document.addEventListener('mousemove',function(e){
		document.getElementById('dbg').innerHTML='('+((e.clientX-(MAXX>>1))/mag+ctx)+','+((e.clientY-(MAXY>>1))/mag+cty)+')';
		if ((marqon)&&(e.button==0)){
			marqx2=e.clientX;marqy2=e.clientY;
			if (marqx1>marqx2){marq_x1=marqx2;marq_x2=marqx1} else {marq_x1=marqx1;marq_x2=marqx2;}
			if (marqy1>marqy2){marq_y1=marqy2;marq_y2=marqy1} else {marq_y1=marqy1;marq_y2=marqy2;}
			marq_x1=ctx+(marq_x1-(MAXX>>1))/mag;
			marq_y1=cty+(marq_y1-(MAXY>>1))/mag;
			marq_x2=ctx+(marq_x2-(MAXX>>1))/mag;
			marq_y2=cty+(marq_y2-(MAXY>>1))/mag;
			DBG='['+marq_x1+','+marq_y1+']-['+marq_x2+','+marq_y2+']';
			repaint();
		}
	});
	document.addEventListener('mouseup',function(e){
		if ((marqon)&&(e.button==0)){
			marqon=false;
			if (marqx1>marqx2){marq_x1=marqx2;marq_x2=marqx1} else {marq_x1=marqx1;marq_x2=marqx2;}
			if (marqy1>marqy2){marq_y1=marqy2;marq_y2=marqy1} else {marq_y1=marqy1;marq_y2=marqy2;}
			marq_x1=ctx+(marq_x1-(MAXX>>1))/mag;
			marq_y1=cty+(marq_y1-(MAXY>>1))/mag;
			marq_x2=ctx+(marq_x2-(MAXX>>1))/mag;
			marq_y2=cty+(marq_y2-(MAXY>>1))/mag;
			DBG='['+marq_x1+','+marq_y1+']-['+marq_x2+','+marq_y2+']';
			for (i=0;i<objects.length;i++){
				objects[i].selected=false;
				if ((objects[i].posx>=marq_x1)&&(objects[i].posx<=marq_x2)&&(objects[i].posy>=marq_y1)&&(objects[i].posy<=marq_y2)){
					objects[i].selected=true;
				}
			}
			repaint();
		}
	});
	document.addEventListener('mousedown',function(e){
		if (e.button==0){
			if (!marqon){
				marqx1=e.clientX;marqy1=e.clientY;
				marqx2=marqx1;marqy2=marqy1;
				marqon=true;
			}
			else{
				marqx2=e.clientX;marqy2=e.clientY;
			}
			repaint();
		}
	});
	document.addEventListener('contextmenu',function(e){
		xpos=ctx+(e.clientX-(MAXX>>1))/mag;
		ypos=cty+(e.clientY-(MAXY>>1))/mag;
		document.getElementById('dbg').innerHTML='<'+xpos+','+ypos+'>';
		for (i=0;i<objects.length;i++){
			if (objects[i].selected){
				objects[i].setHeading(xpos,ypos);
				objects[i].selected=false;
			}
		}
		e.preventDefault();
	});
	objects.push(new Object(0,0));
	objects.push(new Object(3240,850));
	objects.push(new Object(2000,1500));
	repaint();
	run();
}

</script>
</head>
<body onselectstart='return false;' onload="init();"></body>
</html>